# Пишем глобальный Docker Compose бэкенда мониторинга

Пишем **Docker Compose** для связки бэкенда мониторинга аналогично инстансам [первого раздела](https://github.com/lamjob1993/linux-monitoring/tree/main/tasks). Я понимаю, что пока это тестовый полигон, но пока что мы учимся поэтапно и это нормально.

Файлов Docker Compose может быть много и с любыми именами, поэтому создаем отдельную директорию для них и называем текущий Compose, как `docker compose global`. Далее с помощью ключа `-f` запускаем (важно, чтобы контейнеры не конфликтовали между собой, когда будут запущены рядом два Compose, например, в обоих Compose есть Prometheus и у обоих порты `:9090` и одинаковые тома - так быть не должно, просто делайте `docker compose down` и запускайте следующий Compose). 

## Task 4

### Пишем **Docker Compose**
- Отрезаем на **VM**:
  - **`CPU`**: 6/8 Cores
  - **`RAM`**: 4/6Gb
  - **`SSD`**: В дефолте у вас должен быть на 10Gb, [согласно разделу](https://github.com/lamjob1993/linux-monitoring/tree/main/tasks/linux_install)
- Берем в работу бэк мониторинга (следите за обновлениями стека по ссылке выше) и поднимаем (не забываем про подключение `volumes`, про сеть и про проброс портов):
  - **`alertmanager`** _# просто поднять и вывести один тестовый алерт_
  - **`blackbox-exporter`** _# поднять, пропинговать ресурсы и натравить на SSL сертификаты_
  - **`nginx`** _# установить в дефолте + поднять сертификаты_
  - **`nginx-exporter`** _# натравить на Nginx_
  - **`custom_exporter_bash`** _# просто поднять и пропинговать ресурсы_
  - **`grafana`** _# установить в дефолте_
  - **`node-exporter`** _# установить в дефолте_
  - **`postgresql`** _# СУБД просто поднять, создать внутри базу по кредитному конвейеру с таблицами и не набивать данными (это занимает время)_
  - **`postgresql_exporter`** _# натравить на базу_
  - **`process-exporter`** _# установить в дефолте_
  - **`prometheus`** _# натравить на все экспортеры + federation + pushgateway_
  - **`prometheus_federation`** _# в тестовом виде запустить еще два Prometheus: DC1 и DC2 и натравить на них Prometheus Central_
  - **`pushgateway`** _# закурлить десяток тестовых метрик и вывести на дашборд_
- Далее для каждого инстанса из перечисленного выше нужно скачать официальные дашборды с сайта [Grafana Labs](https://grafana.com/grafana/dashboards/)
  - Поднять каждый дашборд отдельно и вывести на каждый метрики
- Далее рисуем один глобальный дашборд (в основу берем официальные дашборды выше), который будет отображать все инстансы выше по списку сверху вниз (то есть это творческая и кастомная работа, по сути рутина инженера по разработке мониторинга):
  - Подумайте над логикой:
    - Сверху должно быть видно алерты
    - Далее железо и сеть
    - Далее процессы
    - Далее статус базы данных
    - Далее статус сервера
    - И так далее
    - И в самом конце вывести информацию для администраторов отдельным `row`
      - Например взять официальные дашборды для Grafana и Prometheus и вывести на них статистику для админов в `row`
- Идем в Draw.io или в Figma и рисуем схему вашего получившегося бэка, согласно **Docker Compose** и выкладываем к себе в pet-прект в репозиторий:
  - Схема должна быть вот [такой](https://miro.com/app/board/uXjVIMhc1ds=/) (лучше сделать в Figma) или [такой](https://raw.githubusercontent.com/lamjob1993/linux-monitoring/fd9a2eb51245e64e09c1da8e2b77ff13d26eaadf/.files/.bucket/%D0%94%D0%B8%D0%B0%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B0%20%D0%BC%D0%BE%D0%BD%D0%B8%D1%82%D0%BE%D1%80%D0%B8%D0%BD%D0%B3%D0%B0.drawio.svg)
  - Первый вариант лучше, он красивый и хорошо читаемый
  - Схема должна читаться в GitHub, формат должен быть `.svg`, [вот такой ](https://github.com/lamjob1993/linux-monitoring/blob/main/.files/.bucket/%D0%94%D0%B8%D0%B0%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B0%20%D0%BC%D0%BE%D0%BD%D0%B8%D1%82%D0%BE%D1%80%D0%B8%D0%BD%D0%B3%D0%B0.drawio.svg)
  - Схему выгружаем в формате `.svg` с сайтов: Draw.io или Figma
  - Исходный код `.svg` открываем в VS Code для проверки и пушим в GitHub
  - Сохраните текущий `Docker Compose` в качестве бэкапа
  - Запушьте получившийся `Docker Compose` в GitHub
