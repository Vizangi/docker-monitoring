# Dockerfile

## Основные конструкции (инструкции) в `Dockerfile`, их назначение и примеры использования:

---

### **1. `FROM`**  
**Назначение**: Указывает базовый образ, на основе которого собирается контейнер.  
**Пример**:  
```dockerfile
FROM ubuntu:22.04
```
- Должен быть первой инструкцией (кроме комментариев и `ARG`).
- Можно использовать образы из Docker Hub (`alpine`, `nginx`, `python` и т. д.).

---

### **2. `RUN`**  
**Назначение**: Выполняет команды внутри контейнера во время сборки.  
**Пример**:  
```dockerfile
RUN apt-get update && apt-get install -y curl
```
- Часто используется для установки пакетов или настройки среды.

---

### **3. `COPY`**  
**Назначение**: Копирует файлы из хоста (вашей машины) в контейнер.  
**Пример**:  
```dockerfile
COPY ./app /usr/src/app
```
- Первый аргумент — путь на хосте, второй — путь в контейнере.

---

### **4. `ADD`**  
**Назначение**: Аналогично `COPY`, но поддерживает:  
- Автоматическую распаковку архивов (`.tar`, `.gz`).  
- Загрузку файлов по URL.  
**Пример**:  
```dockerfile
ADD https://example.com/file.tar.gz /tmp/
```
- Рекомендуется использовать `COPY`, если не нужны особые возможности `ADD`.

---

### **5. `WORKDIR`**  
**Назначение**: Устанавливает рабочую директорию для последующих инструкций.  
**Пример**:  
```dockerfile
WORKDIR /app
```
- Все последующие команды (`RUN`, `CMD` и т. д.) выполняются относительно этой папки.

---

### **6. `ENV`**  
**Назначение**: Устанавливает переменные окружения.  
**Пример**:  
```dockerfile
ENV NODE_ENV=production
```
- Доступны в процессе сборки и в запущенном контейнере.

---

### **7. `ARG`**  
**Назначение**: Определяет переменные, передаваемые при сборке (через `--build-arg`).  
**Пример**:  
```dockerfile
ARG USERNAME=admin
```
- Используются только во время сборки (в отличие от `ENV`).

---

### **8. `EXPOSE`**  
**Назначение**: Указывает, какие порты контейнер будет слушать.  
**Пример**:  
```dockerfile
EXPOSE 80
```
- Не открывает порты автоматически! Для этого нужно использовать `-p` в `docker run`.

---

### **9. `CMD`**  
**Назначение**: Задает команду по умолчанию для запуска контейнера.  
**Пример**:  
```dockerfile
CMD ["nginx", "-g", "daemon off;"]
```
- Может быть переопределена при запуске контейнера (`docker run <image> <новая_команда>`).
- Только одна инструкция `CMD` в `Dockerfile` (если несколько — выполняется последняя).

---

### **10. `ENTRYPOINT`**  
**Назначение**: Определяет основную команду, которую нельзя переопределить.  
**Пример**:  
```dockerfile
ENTRYPOINT ["python", "app.py"]
```
- Аргументы `CMD` добавляются к `ENTRYPOINT`.
- Полезно для создания "исполняемых" контейнеров.

---

### **11. `VOLUME`**  
**Назначение**: Создает точку монтирования для внешних томов.  
**Пример**:  
```dockerfile
VOLUME /var/lib/mysql
```
- Данные в этой папке сохраняются при удалении контейнера.

---

### **12. `USER`**  
**Назначение**: Устанавливает пользователя для запуска процессов.  
**Пример**:  
```dockerfile
USER nobody
```
- Повышает безопасность (не запускать процессы от `root`).

---

### **13. `HEALTHCHECK`**  
**Назначение**: Проверяет работоспособность контейнера.  
**Пример**:  
```dockerfile
HEALTHCHECK --interval=30s --timeout=3s CMD curl -f http://localhost/ || exit 1
```

---

### **14. `LABEL`**  
**Назначение**: Добавляет метаданные (например, версию, автора).  
**Пример**:  
```dockerfile
LABEL maintainer="dev@example.com"
```

---

### **15. `ONBUILD`**  
**Назначение**: Задает команды, которые выполнятся при использовании этого образа как базового для другого `Dockerfile`.  
**Пример**:  
```dockerfile
ONBUILD COPY . /app
```

---

### **16. `.dockerignore`**  
**Не инструкция, но важно**:  
Файл, исключающий копирование ненужных файлов (аналогично `.gitignore`).  
**Пример**:  
```
node_modules
*.log
```

---

### Пример полного `Dockerfile` для Python-приложения:
```dockerfile
FROM python:3.9-slim
WORKDIR /app
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt
COPY . .
ENV FLASK_APP=app.py
EXPOSE 5000
CMD ["flask", "run", "--host", "0.0.0.0"]
```

Этих инструкций достаточно для большинства сценариев. Оптимизация `Dockerfile` (многоступенчатая сборка, уменьшение слоев) — отдельная тема.
